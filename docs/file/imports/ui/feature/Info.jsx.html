<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">imports/ui/feature/Info.jsx | genebook</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="A portable website for browsing and querying genome sequences and annotations"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="genebook"><meta property="twitter:description" content="A portable website for browsing and querying genome sequences and annotations"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/holmrenser/genebook"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#api-blast">api/blast</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-hasBlastDb">hasBlastDb</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-makeBlastDb">makeBlastDb</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-removeBlastDb">removeBlastDb</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-submitBlastJob">submitBlastJob</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#api-downloads">api/downloads</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Downloads">Downloads</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#api-genes">api/genes</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-addInterproscan">addInterproscan</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-addOrthogroupTrees">addOrthogroupTrees</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Attributes">Attributes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Downloads">Downloads</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-downloadGenes">downloadGenes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-EditHistory">EditHistory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-GeneSchema">GeneSchema</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Genes">Genes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SubfeatureSchema">SubfeatureSchema</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Interpro">Interpro</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Orthogroups">Orthogroups</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-scanGeneAttributes">scanGeneAttributes</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#api-genomes">api/genomes</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-addGff">addGff</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-addReference">addReference</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ReferenceInfo">ReferenceInfo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ReferenceInfoSchema">ReferenceInfoSchema</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ReferenceSchema">ReferenceSchema</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-References">References</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Tracks">Tracks</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-trackSchema">trackSchema</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-updateTrackPermissions">updateTrackPermissions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#api-transcriptomes">api/transcriptomes</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ExperimentInfo">ExperimentInfo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ExperimentInfoSchema">ExperimentInfoSchema</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TranscriptomeSchema">TranscriptomeSchema</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Transcriptomes">Transcriptomes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-updateSampleInfo">updateSampleInfo</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#api-users">api/users</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-updateUserInfo">updateUserInfo</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#api-util">api/util</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-formatAttributes">formatAttributes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getGeneSequences">getGeneSequences</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseNewick">parseNewick</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-reverseComplement">reverseComplement</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-translate">translate</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#ui-admin">ui/admin</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-JobProgressBar">JobProgressBar</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#ui-admin-tracks">ui/admin/tracks</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/imports/ui/admin/tracks/TrackPermissionSelect.jsx~TrackPermissionSelect.html">TrackPermissionSelect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AdminTrackInfo">AdminTrackInfo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-BlastDatabaseButtons">BlastDatabaseButtons</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-BlastDatabaseProgressBar">BlastDatabaseProgressBar</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#ui-admin-transcriptomes">ui/admin/transcriptomes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/imports/ui/admin/transcriptomes/ExperimentGroup.jsx~ExperimentGroup.html">ExperimentGroup</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/imports/ui/admin/transcriptomes/SampleInfo.jsx~SampleInfo.html">SampleInfo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/imports/ui/admin/transcriptomes/TrackExperiments.jsx~TrackExperiments.html">TrackExperiments</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#ui-blast">ui/blast</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/imports/ui/blast/BlastResultList.jsx~BlastResultList.html">BlastResultList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/imports/ui/blast/BlastResultPlot.jsx~BlastResultPlot.html">BlastResultPlot</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#ui-feature">ui/feature</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/imports/ui/feature/ProteinDomains.jsx~ProteinDomains.html">ProteinDomains</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/imports/ui/feature/Seq.jsx~SeqContainer.html">SeqContainer</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#ui-genelist">ui/genelist</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/imports/ui/genelist/AttributeSelect.jsx~AttributeSelect.html">AttributeSelect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/imports/ui/genelist/GeneTableCard.jsx~GeneTableCard.html">GeneTableCard</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/imports/ui/genelist/GeneTableOptions.jsx~GeneTableOptions.html">GeneTableOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ThreewayRadioButtons">ThreewayRadioButtons</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-TrackSelect">TrackSelect</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#ui-genelist-downloads">ui/genelist/downloads</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/imports/ui/genelist/downloads/DownloadDialog.jsx~DownloadDialogModal.html">DownloadDialogModal</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#ui-landingpage">ui/landingpage</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/imports/ui/landingpage/Landingpage.jsx~Landingpage.html">Landingpage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#ui-main">ui/main</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/imports/ui/main/MainLayout.jsx~MainLayout.html">MainLayout</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-InactiveAccountWarning">InactiveAccountWarning</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-NotFound">NotFound</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#ui-util">ui/util</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Loading">Loading</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isLoading">isLoading</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-withEither">withEither</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">imports/ui/feature/Info.jsx</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { Meteor } from &apos;meteor/meteor&apos;;
import { Template } from &apos;meteor/templating&apos;;
import { withTracker } from &apos;meteor/react-meteor-data&apos;;

import React from &apos;react&apos;;
import find from &apos;lodash/find&apos;;
import cloneDeep from &apos;lodash/cloneDeep&apos;;
import { diff, apply } from &apos;rus-diff&apos;; 

import { EditHistory } from &apos;/imports/api/genes/edithistory_collection.js&apos;;
import { Attributes } from &apos;/imports/api/genes/attribute_collection.js&apos;;

import &apos;./info.scss&apos;;

const canEdit = () =&gt; {
  return true
}

const Controls = (props) =&gt; {
  return (
    &lt;div&gt;
      {
        props.showHistory &amp;&amp;
        &lt;button type=&quot;button&quot; className=&quot;btn btn-outline-secondary btn-sm pull-right viewingHistory&quot; onClick={props.toggleHistory}&gt;
          &lt;i className=&quot;fa fa-history&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; Hide history
        &lt;/button&gt;
      }
      {
        props.totalVersionNumber &gt; 0 &amp;&amp; !props.isEditing &amp;&amp; !props.showHistory &amp;&amp;
        &lt;button type=&quot;button&quot; className=&quot;btn btn-outline-secondary btn-sm pull-right viewingHistory&quot; onClick={props.toggleHistory}&gt;
          &lt;i className=&quot;fa fa-history&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; 
          &amp;nbsp;Show history&amp;nbsp;
          &lt;span className=&quot;badge badge-secondary&quot;&gt;{ props.totalVersionNumber }&lt;/span&gt;
        &lt;/button&gt;
      }
      {
        canEdit() &amp;&amp; !props.isEditing &amp;&amp; !props.showHistory &amp;&amp;
        &lt;button type=&quot;button&quot; className=&quot;btn btn-outline-secondary btn-sm pull-right edit&quot; onClick={props.startEdit}&gt;
          &lt;i className=&quot;fa fa-pencil-square-o&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; Edit
        &lt;/button&gt;
      }
      {
        canEdit() &amp;&amp; props.isEditing &amp;&amp; !props.showHistory &amp;&amp;
        &lt;div className=&quot;btn-group pull-right&quot;&gt;
          &lt;button type=&quot;button&quot; className=&quot;btn btn-outline-success btn-sm save&quot; onClick={props.saveEdit}&gt;
            &lt;i className=&quot;fa fa-floppy-o&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; Save
          &lt;/button&gt;
          &lt;button type=&quot;button&quot; className=&quot;btn btn-danger btn-sm cancel&quot; onClick={props.cancelEdit}&gt;
            &lt;i className=&quot;fa fa-times&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; Cancel
          &lt;/button&gt;
        &lt;/div&gt;
      }
    &lt;/div&gt;
  )
}

const VersionHistory = (props) =&gt; {
  const hasNextVersion = props.currentVersionNumber &lt; props.totalVersionNumber;
  const hasPreviousVersion = props.currentVersionNumber != 0;
  return (
    &lt;div&gt;
      &lt;div className=&quot;alert alert-danger&quot; role=&quot;alert&quot;&gt;
        &lt;i className=&quot;fa fa-exclamation-circle&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;
        You are watching version &lt;b&gt;{ props.currentVersionNumber } / { props.totalVersionNumber } &lt;/b&gt; 
        of this gene by { props.editBy } at { props.editAt }.
        { 
          Roles.userIsInRole(Meteor.userId(),&apos;admin&apos;) &amp;&amp;
          &lt;a href=&quot;#&quot; className=&quot;alert-link&quot; onClick = {props.restoreVersion}&gt;Click here to revert to this version.&lt;/a&gt;
        }
      &lt;/div&gt;
      &lt;div className=&quot;pager&quot;&gt;
        &lt;button className=&quot;btn btn-sm btn-dark&quot; name=&quot;previous&quot; onClick={ props.selectVersion } disabled={!hasPreviousVersion}&gt;
          &lt;i className={`fa ${hasPreviousVersion ? &apos;fa-arrow-left&apos; : &apos;fa-ban&apos;}`} aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; Older
        &lt;/button&gt;
        &lt;button className=&quot;btn btn-sm btn-dark pull-right&quot; name=&quot;next&quot; onClick={ props.selectVersion } disabled={!hasNextVersion}&gt;
          Newer &lt;i className={`fa ${hasNextVersion ? &apos;fa-arrow-right&apos; : &apos;fa-ban&apos;}`} aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  )
}

const AttributeInput = (props) =&gt; {
  return (
    &lt;div className=&quot;input-group&quot;&gt;
      &lt;input 
        type = &quot;text&quot; 
        className = &quot;form-control&quot; 
        onChange = { props.onChange } 
        name = { props.name } 
        value = { props.value } /&gt;
      &lt;div className=&quot;input-group-append&quot;&gt;
        &lt;button 
          type=&quot;button&quot;
          className=&quot;btn btn-danger&quot;
          name={props.name}
          onClick = {props.deleteAttribute.bind(this,props.name)}&gt;
          &lt;span className=&quot;fa fa-trash-o&quot;/&gt;
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  )
}

class Info extends React.Component {
  constructor(props){
    super(props)
    this.state = {
      reversions: 0,
      attributes: this.props.gene.attributes,
      newAttributes: undefined,
      isEditing: false,
      addingNewAttribute: false,
      showHistory: false,
      newAttributeKey: undefined,
      newAttributeValue: undefined
    }
  }

  selectVersion = (version) =&gt; {
    this.setState({reversions: version})
  }

  startEdit = () =&gt; {
    console.log(&apos;start editing&apos;)
    //implement logic to lock gene from being edited by others
    this.setState({ isEditing: true })
  }

  saveEdit = () =&gt; {
    console.log(&apos;save edit&apos;)
    console.log(this.state)
    
    const oldGene = this.props.gene;
    oldGene.attributes = this.state.attributes;
    
    const newGene = cloneDeep(this.props.gene);
    if (this.state.newAttributes){
      newGene.attributes = this.state.newAttributes
    }
    newGene.changed = true;
    if (this.state.newAttributeKey || this.state.newAttributeValue){
      if (!(this.state.newAttributeKey &amp;&amp; this.state.newAttributeValue)){
        if (!this.state.newAttributeKey){
          alert(&apos;New attribute key required&apos;)
        } else {
          alert(&apos;New attribute value required!&apos;)
        }
        throw new Meteor.Error(&apos;Incorrect new attribute&apos;)
      } else {
        if (!newGene.attributes){
          newGene.attributes = {}
        }
        newGene.attributes[this.state.newAttributeKey] = this.state.newAttributeValue;
      }
    }

    const update = diff(oldGene, newGene)
    const revert = diff(newGene, oldGene)
    const geneId = this.props.gene.ID;

    Meteor.call(&apos;updateGeneInfo&apos;,geneId,update,revert,(err,res) =&gt; {
      if (err) {
        console.error(err)
      }
      if (res) {
        console.log(res)
      }
    })
    //save changes and unlock gene so it can be edited by others again
    this.setState({ 
      isEditing: false,
      newAttributes: undefined,
      attributes: this.state.newAttributes,
      addingNewAttribute: false
    })
  }

  cancelEdit = () =&gt; {
    console.log(&apos;cancel edit&apos;)
    //unlock gene so it can be edited by others again
    this.setState({ 
      isEditing: false,
      newAttributes: undefined,
      addingNewAttribute: false 
    })
  }

  restoreVersion = () =&gt; {
    console.log(&apos;restoreVersion&apos;)
  }

  deleteAttribute = (key) =&gt; {
    let attributes = this.state.newAttributes ? cloneDeep(this.state.newAttributes) : cloneDeep(this.state.attributes);
    delete attributes[key];
    this.setState({
      newAttributes: attributes
    })
  }

  changeAttributeValue = (event) =&gt; {
    event.preventDefault();
    const value = event.target.value;
    const key = event.target.name;
    let attributes = this.state.newAttributes ? this.state.newAttributes : cloneDeep(this.state.attributes);
    attributes[key] = value;
    this.setState({
      newAttributes: attributes
    })
  }

  startAddingAttribute = () =&gt; {
    this.setState({
      addingNewAttribute: true
    })
  }

  addNewAttributeKey = (event) =&gt; {
    const newAttributeKey = event.target.value;
    this.setState({
      newAttributeKey: newAttributeKey
    })
  }

  addNewAttributeValue = (event) =&gt; {
    const addNewAttributeValue = event.target.value;
    this.setState({
      newAttributeValue: addNewAttributeValue
    })
  }

  toggleHistory = () =&gt; {
    this.setState({
      reversions: 0,
      showHistory: !this.state.showHistory,
      newAttributes: undefined,
      attributes: this.props.gene.attributes
    })
  }

  selectVersion = (event) =&gt; {
    const increment = event.target.name === &apos;previous&apos; ? 1 : -1
    const reversions = this.state.reversions + increment;
    if (0 &lt;= reversions &amp;&amp; reversions &lt;= this.props.editHistory.length){
      const gene = this.props.editHistory.slice(0, reversions).reduce( (gene,reversion) =&gt; {
        apply(gene,JSON.parse(reversion.revert))
        return gene
      },cloneDeep(this.props.gene))

      const attributes = gene.attributes;
      this.setState({
        reversions: reversions,
        attributes: attributes
      })
    }
  }

  render(){
    const gene = this.props.gene;
    const attributes = this.state.newAttributes ? this.state.newAttributes : this.state.attributes;

    const currentVersion = this.props.editHistory[0]

    const interproDomains = gene.subfeatures.filter(sub =&gt; {
      return sub.type === &apos;mRNA&apos; &amp;&amp; typeof sub.protein_domains !== &apos;undefined&apos;
    }).map(sub =&gt; {
      return sub.protein_domains.filter(domain =&gt; {
        return typeof domain.dbxref !== &apos;undefined&apos;
      }).map(domain =&gt; {
        return domain.dbxref.filter(dbxref =&gt; /^InterPro.*/.test(dbxref))
      })
    })

    //console.log(interproDomains)

    return (
      &lt;div id=&quot;info&quot;&gt;
        &lt;Controls
          showHistory = { this.state.showHistory }
          toggleHistory = { this.toggleHistory }
          totalVersionNumber = { this.props.editHistory.length }
          currentVersionNumber = { this.props.editHistory.length - this.state.reversions }
          isEditing = { this.state.isEditing }
          startEdit = { this.startEdit }
          saveEdit = { this.saveEdit }
          cancelEdit = { this.cancelEdit }
        /&gt;
        &lt;h3&gt;General information&lt;/h3&gt;
        {
          this.state.showHistory &amp;&amp;
          &lt;VersionHistory 
            currentVersionNumber = { this.props.editHistory.length - this.state.reversions }
            totalVersionNumber = { this.props.editHistory.length }
            selectVersion = { this.selectVersion }
            restoreVersion = { this.restoreVersion }
            editBy = { currentVersion.user }
            editAt = { currentVersion.date.toDateString() } /&gt;
        }
        &lt;div className=&quot;table-responive&quot;&gt;
          &lt;table className=&quot;table table-hover&quot;&gt;
            &lt;tbody&gt;
              &lt;tr&gt;
                &lt;td&gt;Reference&lt;/td&gt;
                &lt;td&gt;{ gene.reference }&lt;/td&gt;
              &lt;/tr&gt;
              &lt;tr&gt;
                &lt;td&gt;Genome coordinates&lt;/td&gt;
                &lt;td&gt;{ gene.seqid } { gene.start }..{gene.end} { gene.strand }&lt;/td&gt;
              &lt;/tr&gt;
              &lt;tr&gt;
                &lt;td&gt;Source&lt;/td&gt;
                &lt;td&gt;{ gene.source }&lt;/td&gt;
              &lt;/tr&gt;
              {
                gene.orthogroup &amp;&amp;
                &lt;tr&gt;
                  &lt;td&gt;Orthogroup&lt;/td&gt;
                  &lt;td&gt;{ gene.orthogroup }&lt;/td&gt;
                &lt;/tr&gt;
              }
              { attributes &amp;&amp;
                Object.keys(attributes).map(key =&gt; {
                  const value = attributes[key];
                  return (
                    &lt;tr key = { key }&gt;
                      &lt;td&gt;
                        { key }
                      &lt;/td&gt;
                      &lt;td&gt;
                        {
                          this.state.isEditing ?
                          &lt;AttributeInput 
                            name = {key} 
                            value = {value} 
                            onChange = {this.changeAttributeValue}
                            deleteAttribute = {this.deleteAttribute} /&gt; :
                          value
                        }
                      &lt;/td&gt;
                    &lt;/tr&gt;
                  )
                })
              }
              {
                this.state.isEditing &amp;&amp; this.state.addingNewAttribute &amp;&amp;
                &lt;tr&gt;
                  &lt;td&gt;
                    &lt;div className=&quot;input-group&quot;&gt;
                      &lt;span className=&quot;input-group-addon&quot;&gt;Key&lt;/span&gt;
                      &lt;input
                        list = &apos;attributes&apos;
                        type = &apos;text&apos;
                        className = &apos;form-control&apos;
                        onChange = { this.addNewAttributeKey } /&gt;
                      &lt;datalist id=&apos;attributes&apos;&gt;
                        {
                          this.props.attributeNames.map(attributeName =&gt; {
                            return (
                              &lt;option value={attributeName} key={attributeName} /&gt;
                            )
                          })
                        }
                      &lt;/datalist&gt;
                    &lt;/div&gt;
                  &lt;/td&gt;
                  &lt;td&gt;
                    &lt;div className=&apos;input-group&apos;&gt;
                      &lt;span className=&quot;input-group-addon&quot;&gt;Value&lt;/span&gt;
                      &lt;input
                        type = &apos;text&apos;
                        className = &apos;form-control&apos;
                        onChange = { this.addNewAttributeValue } /&gt;
                    &lt;/div&gt;
                  &lt;/td&gt;
                &lt;/tr&gt;
              }
            &lt;/tbody&gt;
          &lt;/table&gt;
          {
            this.state.isEditing &amp;&amp; !this.state.addingNewAttribute &amp;&amp;
            &lt;div className = &apos;text-center&apos;&gt;
              &lt;button 
                type = &apos;button&apos;
                className = &apos;btn btn-success&apos;
                onClick = {this.startAddingAttribute}&gt;
                Add new attribute
              &lt;/button&gt;
            &lt;/div&gt;
          }
        &lt;/div&gt;
      &lt;/div&gt;
    )
  }
}

export default withTracker( props =&gt; {
  Meteor.subscribe(&apos;editHistory&apos;);
  Meteor.subscribe(&apos;attributes&apos;);
  //Meteor.subscribe(&apos;singleGene&apos;,props.gene.ID)

  const editHistory = EditHistory.find({
      ID: props.gene.ID
    },{
      sort: {
        date: -1
      }
    }).fetch();

  const attributeNames = Attributes.find({
    reserved: false
  },{
    field: name
  }).map( attribute =&gt; attribute.name)

  return {
    gene: props.gene,
    editHistory: editHistory,
    attributeNames: attributeNames
  }
})(Info);</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
